<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supplier Management Form</title>
  <!--<link rel="stylesheet" href="../../assets/icon/icon.jpeg" >-->

  <meta content="Shoe Shop Management System" name="keywords">
  <meta content="This is shoe management project" name="description">
  <meta content="Sethmini Dissanayake" name="author">
  <meta content="Sethmini Dissanayake" name="owner">
  <meta content="width=device-width initial-scale=1 maximum-scale=1 minimum-scale=1 user-scalable=no" name="viewport">
  <meta content="green" name="theme-color">

  <link href="../../assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <link href="../../assets/vendor/styleslog/sb-admin-2.min.css" rel="stylesheet">
  <link href="../../assets/vendor/sweetalert2-11.6.16/sweetalert2.min.css" rel="stylesheet">

  <style>
    .sidebar-nav .nav-link {
      font-size: 22px;
    }

  </style>
  <link rel="stylesheet" href="../../assets/css/Dashboard.css">
  <script src="../../assets/js/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="../../assets/css/styles.css">
  <script src="../../assets/js/supplier.js"></script>
</head>
<body style=" background-color: #f8f9fa">

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">
    <img src="../../assets/icon/icon.jpeg" alt="Logo" class="logo mr-2"> Hello Shoe- Shoe Management System
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="../../assets/img/admin1.jpg" alt="Admin Photo" class="rounded-circle" style="width: 50px;">
          David Wilson
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">My Profile</a>
          <a class="dropdown-item" href="#">Account Settings</a>
          <a class="dropdown-item" href="#">Need Help</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Sign Out</a>
        </div>
      </li>
    </ul>
  </div>
</nav>

<div class="sidebar">
  <a href="../../pages/adminDashboard.html">Dashboard</a>
  <a href="../adminPages/SaleManagement.html">Sales</a>
  <a href="../adminPages/OrderDetails.html">Sale Details</a>
  <a href="../adminPages/SupplierManagement.html">Suppliers</a>
  <a href="../adminPages/CustomerManagement.html">Customers</a>
  <a href="../adminPages/EmployeeManagement.html">Employees</a>
  <a href="../adminPages/InventoryManagement.html">Inventory</a>
  <a href="#">Users</a>
  <a href="#">Log Out</a>
</div>

<main id="main" class="main" style="padding-left: 100px">
  <div class="container mt-5">
    <h2>Supplier Form</h2>
    <form>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="supplierCode">Supplier Code</label>
          <input type="text" class="form-control" id="supplierCode" placeholder="Supplier Code" required>
        </div>
        <div class="form-group col-md-6">
          <label for="supplierName">Supplier Name</label>
          <input type="text" class="form-control" id="supplierName" placeholder="Supplier Name" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="category">Category</label>
          <select id="category" class="form-control">
            <option selected>Choose...</option>
            <option value="INTERNATIONAL">INTERNATIONAL</option>
            <option value="LOCAL">LOCAL</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="inputAddress">Address</label>
          <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St" required>
        </div>
        <div class="form-group col-md-6">
          <label for="inputCity">City & State</label>
          <input type="text" class="form-control" id="inputCity" placeholder="city" required>
        </div>

      </div>

      <div class="form-group">
        <label for="contactNumber1">Contact</label>
        <div class="form-row">
          <div class="form-group col-md-6">
            <input type="text" class="form-control" id="contactNumber1" placeholder="Contact Number" required>
          </div>
          <div class="form-group col-md-6">
            <input type="text" class="form-control" id="contactNumber2" placeholder="Another Contact Number" required>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="inputEmail">E-mail</label>
        <input type="text" class="form-control" id="inputEmail" placeholder="abcd12#gmail.com" required>
      </div>

      <button id="btnSupplierSave"  type="button" class="btn btn-primary mr-2 " style="background-color: #00d25b" >Submit</button>
      <button id="btnSupplierUpdate" type="button" class="btn btn-primary mr-2" style="background-color: #fc424a" >Update</button>
      <button id="btnSupplierDelete" type="button" class="btn btn-primary mr-2" style="background-color: #ffab00">Delete</button>
      <button id="btnSupplierClear" type="button" class="btn btn-dark" style="background-color: #8f5fe8">Clear</button>

    </form>
  </div>

  <div class="card info-card" style="margin-top: 10px; margin-right: 12px;margin-left: 90px">
    <div class="row mt-1 mt-md-2 mt-lg-4 mm-2 p-2 justify-content-around" style="height: 350px;">
      <div class="col-11 justify-content-around sectionBorder"
           style="height: 290px; background: white">
        <div class="table-responsive customerTableDiv overflow-auto " style="height: 300px;">
          <table class="table table-light table-striped table-bordered table-hover" >
            <thead class="text-dark table-danger text-center  table-bordered sticky-top">
            <tr>
              <th scope="col">Supplier Code</th>
              <th scope="col">Supplier Name</th>
              <th scope="col">Category</th>
              <th scope="col">Address</th>
              <th scope="col">Contact No.1</th>
              <th scope="col">Contact No.1 </th>
              <th scope="col">E-mail</th>


            </tr>
            </thead>
            <tbody id="supplierTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- View Customer Details Table End -->
  </div>
</main>

<footer id="footer" class="footer">
  <div class="copyright">
    &copy; Copyright <strong><span>Shoe Management System</span></strong>. All Rights Reserved
  </div>
  <div class="credits">
    Designed by <a href="">Sethmini Dissanayake</a>
  </div>
</footer>

<script>
  getAllSuppliers();
  /*loadNextCustomerId();*/

  /*get all*/
  function getAllSuppliers() {
    $.ajax({
      url: "http://localhost:8080/app/api/v1/suppliers/getAllSuppliers",
      method: "GET",
      dataType: "json",
      success: function (response) {
        console.log(response);
        console.log(response.length);
        loadSupplierDataInTable(response);
        generateSupplierId();
      },
      error: function (xhr, status, err) {
        console.log(err)
      }
    })
  }


  function loadSupplierDataInTable(suppliers) {
    var tableBody = document.getElementById("supplierTable");
    tableBody.innerHTML = "";

    suppliers.forEach(function(supplier) {
      var row = document.createElement("tr");

      ["supplierCode", "supplierName", "category", "address", "contactNo1", "contactNo2", "email"].forEach(function(property) {
        var cell = document.createElement("td");
        cell.textContent = supplier[property];
        row.appendChild(cell);
      });

      tableBody.appendChild(row);
    });
  }

  /*$("#btnSupplierSave").click(function (){
      saveSupplier();
  })*/

  $(document).on("click", "#btnSupplierSave", function() {
    console.log("Button clicked");
    saveSupplier();
  });

  /*function saveSupplier(){
      const supplierCode = $("#supplierCode").val();
      const supplierName = $("#supplierName").val();
      const category = $("#category").val();
      const address1 = $("#inputAddress").val();
      const address2 = $("#inputCity").val();
      const contactNo1 = $("#contactNumber1").val();
      const contactNo2 = $("#contactNumber2").val();
      const email = $("#inputEmail").val();

      const supplier = {
          supplierCode: supplierCode,
          supplierName: supplierName,
          category: category,
          address: `${address1}, ${address2}`,
          contactNo1: contactNo1,
          contactNo2: contactNo2,
          email: email
      };

      $.ajax({
          url: 'http://localhost:8080/app/api/v1/suppliers/save',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(supplier),
          success: function (response) {
              console.log(response);
              alert('Supplier information saved successfully!');
              getAllSuppliers(); // Assuming this function retrieves all suppliers after saving
          },
          error: function (xhr, status, error) {
              console.error(xhr.responseText);
              alert('Failed to save supplier information. Please try again.');
          }
      });
  }*/

  function saveSupplier(){
    const supplierCode = $("#supplierCode").val().trim();
    const supplierName = $("#supplierName").val().trim();
    const category = $("#category").val().trim();
    const address1 = $("#inputAddress").val().trim();
    const address2 = $("#inputCity").val().trim();
    const contactNo1 = $("#contactNumber1").val().trim();
    const contactNo2 = $("#contactNumber2").val().trim();
    const email = $("#inputEmail").val().trim();


    const supplier = {
      supplierCode: supplierCode,
      supplierName: supplierName,
      category: category,
      address: `${address1}, ${address2}`,
      contactNo1: contactNo1,
      contactNo2: contactNo2,
      email: email
    };

    $.ajax({
      url: 'http://localhost:8080/app/api/v1/suppliers/save',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(supplier),
      success: function (response) {
        console.log(response);
        alert('Supplier information saved successfully!');
        getAllSuppliers();
      },
      error: function (xhr, status, error) {
        console.error(xhr.responseText);
        alert('Failed to save supplier information. Please try again.');
      }
    });
  }


  /*table click*/
  $('#supplierTable').on('click', 'tr', function (){
    var supplierCode = $(this).find('td:eq(0)').text();
    var supplierName = $(this).find('td:eq(1)').text();
    var category = $(this).find('td:eq(2)').text();
    var address = $(this).find('td:eq(3)').text();
    var contactNo1 = $(this).find('td:eq(4)').text();
    var contactNo2 = $(this).find('td:eq(5)').text();
    var email = $(this).find('td:eq(6)').text();

    $("#supplierCode").val(supplierCode);
    $("#supplierName").val(supplierName);
    $("#category").val(category);
    $("#inputAddress").val(address);
    $("#contactNumber1").val(contactNo1);
    $("#contactNumber2").val(contactNo2);
    $("#inputEmail").val(email);
  })

  $("#btnSupplierUpdate").click(function (){
    updateSupplier();
  })

  /*save*/
  function updateSupplier(){
    const supplierCode = document.getElementById('supplierCode').value;
    const supplierName = document.getElementById('supplierName').value;
    const category = document.getElementById('category').value;
    const address1 = document.getElementById('inputAddress').value;
    const address2 = document.getElementById('inputCity').value;
    const contactNo1= document.getElementById('contactNumber1').value;
    const contactNo2 = document.getElementById('contactNumber2').value;
    const email = document.getElementById('inputEmail').value;

    const supplier = {
      supplierCode:supplierCode,
      supplierName:supplierName,
      category:category,
      address:`${address1},${address2}`,
      contactNo1:contactNo1,
      contactNo2:contactNo2,
      email:email
    }

    $.ajax({
      url: 'http://localhost:8080/app/api/v1/suppliers/update',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(supplier),
      success: function (response) {
        console.log(response);
        /*document.getElementById('customerForm').reset();*/
        alert('Supplier information updated successfully!');

      },
      error: function (xhr, status, error) {
        console.error(error);
        alert('Failed to update supplier information. Please try again.');
      }
    });
  }

  $(document).ready(function () {
    getAllSuppliers();

    $('#btnSupplierDelete').on('click', function() {
      var supplierCode = $('#supplierCode').val();
      if (supplierCode !== "") {
        deleteSupplier(supplierCode);
      } else {
        alert("Please select a supplier to delete.");
      }
    });
  });

  /*delete customer*/
  function deleteSupplier(supplierCode) {
    $.ajax({
      url: 'http://localhost:8080/app/api/v1/suppliers/' + supplierCode,
      type: 'DELETE',
      success: function (response) {
        console.log(response);
        alert('Supplier deleted successfully!');
        getAllSuppliers();
      },
      error: function (xhr, status, error) {
        console.error(error);
        alert('Failed to delete supplier. Please try again.');
      }
    });
  }

  function generateSupplierId() {
    $("#supplierCode").val("S00-001");
    $.ajax({
      url: "http://localhost:8080/app/api/v1/suppliers/SupplierIdGenerate",
      method: "GET",
      contentType: "application/json",
      dataType: "json",
      success: function (resp) {
        let id = resp.value;
        console.log("id" +id);

        if (id === null){
          $("#supplierCode").val("S00-001" );
        } else {
          let tempId = parseInt(id.split("-")[1]);
          tempId = tempId + 1;
          if (tempId <= 9) {
            $("#supplierCode").val("S00-00" + tempId);
          } else if (tempId <= 99) {
            $("#supplierCode").val("S00-0" + tempId);
          } else {
            $("#supplierCode").val("S00-" + tempId);
          }
        }
      },
      error: function (ob, statusText, error) {

      }
    });
  }


  $(document).ready(function () {
    getAllSuppliers();
  });

  function customerCapitalizeFirstLetter(str) {
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
  }
</script>

</body>
</html>
