<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Management Form</title>
  <meta name="keywords" content="Shoe Shop Management System">
  <meta name="description" content="This is shoe management project">
  <meta name="author" content="Sethmini Dissanayake">
  <meta name="owner" content="Sethmini Dissanayake">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <meta name="theme-color" content="green">

  <link href="../assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,800,900" rel="stylesheet">
  <link href="../assets/vendor/styleslog/sb-admin-2.min.css" rel="stylesheet">
  <link href="../assets/vendor/sweetalert2-11.6.16/sweetalert2.min.css" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <style>
    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      width: 250px;
      color: white;
      padding-top: 20px;
    }

    .sidebar a {
      color: white;
      text-decoration: none;
      display: block;
      padding: 10px 20px;
    }

    .sidebar a:hover, .sidebar a.active {
      background-color: #007bff;
      border-radius: 5px;
    }

    .main {
      margin-left: 250px;
      padding: 20px;
    }

    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
    }

    body {
      padding-top: 70px; /* Adjust according to the height of your navbar */
    }

    .form-group label {
      font-weight: bold;
    }

    .btn-custom {
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    .btn-custom:hover {
      background-color: #0056b3;
    }

    .card {
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    .navbar-brand img {
      width: 30px;
      margin-right: 10px;
    }

    .table thead {
      position: sticky;
      top: 0;
      z-index: 1;
      background-color: white;
    }

    .footer {
      text-align: center;
      padding: 10px;
      background-color: #f8f9fa;
    }

    .container form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body style="background-color: #f8f9fa">

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">
    <img src="../assets/icon/icon.jpeg" alt="Logo" class="logo mr-2"> Shoe Management System
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <form class="form-inline my-2 my-lg-0 ml-auto">
      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="searchInput">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit" id="btnItemSearch">Search</button>
    </form>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="../assets/img/admin1.jpg" alt="Admin Photo" class="rounded-circle" style="width: 50px;">
          David Wilson
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">My Profile</a>
          <a class="dropdown-item" href="#">Account Settings</a>
          <a class="dropdown-item" href="#">Need Help</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Sign Out</a>
        </div>
      </li>
    </ul>
  </div>
</nav>

<div class="sidebar" style="background-color: #a3b6ee">
  <a href="adminDashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
  <a href="SaleManagement.html"><i class="fas fa-dollar-sign"></i> Sales</a>
  <a href="OrderDetails.html"><i class="fas fa-receipt"></i> Sale Details</a>
  <a href="SupplierManagement.html"><i class="fas fa-truck"></i> Suppliers</a>
  <a href="CustomerManagement.html"><i class="fas fa-users"></i> Customers</a>
  <a href="EmployeeManagement.html"><i class="fas fa-user-tie"></i> Employees</a>
  <a href="../adminPages/InventoryManagement.html"><i class="fas fa-boxes"></i> Inventory</a>
  <a href="#"><i class="fas fa-user"></i> Users</a>
  <a href="#"><i class="fas fa-sign-out-alt"></i> Log Out</a>
</div>

<main class="main">
  <div class="container">
    <h2>Inventory Form</h2>
    <form>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="itemCode">Item Code</label>
          <input type="text" class="form-control" id="itemCode" placeholder="Item Code">
        </div>
        <div class="form-group col-md-6">
          <label for="itemDesc">Item Description</label>
          <input type="text" class="form-control" id="itemDesc" placeholder="Item Description">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="itemImage">Item Picture (Base64)</label>
          <input type="file" id="itemImage" name="itemImage" accept="image/*">
          <img id="itemPicDisplay" src="" alt="Selected Image" style="max-width: 200px; max-height: 200px;">
        </div>
        <div class="form-group col-md-6">
          <label for="itemCategory">Category</label>
          <input type="text" class="form-control" id="itemCategory" placeholder="Category">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="size">Size</label>
          <input type="text" class="form-control" id="size" placeholder="Size">
        </div>
        <div class="form-group col-md-6">
          <label for="supplierCode">Supplier Code</label>
          <input type="text" class="form-control" id="supplierCode" placeholder="Supplier Code">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="supplierName">Supplier Name</label>
          <input type="text" class="form-control" id="supplierName" placeholder="Supplier Name">
        </div>
        <div class="form-group col-md-6">
          <label for="unitPrice">Unit Price - Sale</label>
          <input type="text" class="form-control" id="unitPrice" placeholder="Unit Price - Sale">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="unitPriceBuy">Unit Price - Buy</label>
          <input type="text" class="form-control" id="unitPriceBuy" placeholder="Unit Price - Buy">
        </div>
        <div class="form-group col-md-6">
          <label for="profit">Expected Profit</label>
          <input type="text" class="form-control" id="profit" placeholder="Expected Profit">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="profitMargin">Profit Margin</label>
          <input type="text" class="form-control" id="profitMargin" placeholder="Profit Margin">
        </div>
        <div class="form-group col-md-6">
          <label for="status">Status</label>
          <select id="status" class="form-control">
            <option selected>Choose...</option>
            <option value="LOW">LOW</option>
            <option value="AVAILABLE">AVAILABLE</option>
            <option value="NOT_AVAILABLE">NOT AVAILABLE</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="quantity">Quantity</label>
          <input type="text" class="form-control" id="quantity" placeholder="Quantity">
        </div>
      </div>

      <div class="form-group">
        <button id="btnItemSave" type="button" class="btn btn-custom mr-2">Submit</button>
        <button id="btnItemUpdate" type="button" class="btn btn-warning mr-2">Update</button>
        <button id="btnItemDelete" type="button" class="btn btn-danger mr-2">Delete</button>
        <button id="btnItemClear" type="button" class="btn btn-dark">Clear</button>
      </div>
    </form>
  </div>

  <div class="card">
    <div class="card-header">
      Inventory List
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="thead-dark text-center">
          <tr>
            <th scope="col">Item Code</th>
            <th scope="col">Item Description</th>
            <th scope="col">Item Image</th>
            <th scope="col">Category</th>
            <th scope="col">Size</th>
            <th scope="col">Quantity</th>
            <th scope="col">Supplier Code</th>
            <th scope="col">Supplier Name</th>
            <th scope="col">Unit Price - Sale</th>
            <th scope="col">Unit Price - Buy</th>
            <th scope="col">Expected Profit</th>
            <th scope="col">Profit Margin</th>
            <th scope="col">Status</th>
          </tr>
          </thead>
          <tbody id="inventoryTable"></tbody>
        </table>
      </div>
    </div>
  </div>
</main>

<footer class="footer">
  <div>&copy; <strong>Shoe Management System</strong>. All Rights Reserved</div>
  <div>Designed by <a href="#">Sethmini Dissanayake</a></div>
</footer>


<script>
  getAllItems();
  /*loadNextCustomerId();*/

  /*get all*/
  function getAllItems() {
    $.ajax({
      url: "http://localhost:8080/app/api/v1/inventories/getAllItems",
      method: "GET",
      dataType: "json",
      success: function (response) {
        console.log(response);
        console.log(response.length);
        loadItemDataInTable(response);
      },
      error: function (xhr, status, err) {
        console.log(err)
      }
    })
  }

  function loadItemDataInTable(items) {
    var tableBody = document.getElementById("inventoryTable");
    tableBody.innerHTML = "";

    items.forEach(function(item) {
      var row = document.createElement("tr");

      ["itemCode", "itemDesc", "itemPicture","category", "size", "quantity", "supplierCode", "supplierName", "unitPriceSale",
        "unitPriceBuy","expectProfit","profitMargin","status"].forEach(function(property) {
        var cell = document.createElement("td");
        cell.textContent = item[property];
        row.appendChild(cell);
      });
      tableBody.appendChild(row);
    });
  }
  $("#btnItemSave").click(function (){
    saveItem();
  })

  document.getElementById('itemImage').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = function(e) {
      const base64String = e.target.result.split(',')[1]; // Get base64 string without metadata
      document.getElementById('itemPicDisplay').src = e.target.result; // Display the image
      document.getElementById('itemImage').setAttribute('data-base64', base64String); // Store base64 string in a data attribute
    };

    if (file) {
      reader.readAsDataURL(file); // Convert the image file to base64
    }
  });
  /*save*/
  function saveItem(){
    const itemCode = document.getElementById('itemCode').value;
    const itemDesc = document.getElementById('itemDesc').value;
    const itemPicBase64 = document.getElementById('itemImage').getAttribute('data-base64');
    const category = document.getElementById('itemCategory').value;
    const size= document.getElementById('size').value;
    const quantity = document.getElementById('quantity').value;
    const supplierCode = document.getElementById('supplierCode').value;
    const supplierName = document.getElementById('supplierName').value;
    const unitPriceSale = document.getElementById('unitPrice').value;
    const unitPriceBuy = document.getElementById('unitPriceBuy').value;
    const expectProfit = document.getElementById('profit').value;
    const profitMargin = document.getElementById('profitMargin').value;
    const status = document.getElementById('status').value;


    const item = {
      itemCode:itemCode,
      itemDesc:itemDesc,
      itemPicture:itemPicBase64,
      category:category,
      size:size,
      quantity:quantity,
      supplierCode:supplierCode,
      supplierName:supplierName,
      unitPriceSale:unitPriceSale,
      unitPriceBuy:unitPriceBuy,
      expectProfit:expectProfit,
      profitMargin:profitMargin,
      status:status,
    }

    $.ajax({
      url: 'http://localhost:8080/app/api/v1/inventories/save',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(item),
      success: function (response) {
        console.log(response);
        /*document.getElementById('customerForm').reset();*/
        alert('Item information saved successfully!');
        getAllItems();

      },
      error: function (xhr, status, error) {
        console.error(error);
        alert('Failed to save item information. Please try again.');
      }
    });
  }

  $("#btnItemUpdate").click(function (){
    updateItem();
  })


  document.getElementById('itemImage').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = function(e) {
      const base64String = e.target.result.split(',')[1]; // Get base64 string without metadata
      document.getElementById('itemPicDisplay').src = e.target.result; // Display the image
      document.getElementById('itemImage').setAttribute('data-base64', base64String); // Store base64 string in a data attribute
    };

    if (file) {
      reader.readAsDataURL(file); // Convert the image file to base64
    }
  });
  /*save*/
  function updateItem(){
    const itemCode = document.getElementById('itemCode').value;
    const itemDesc = document.getElementById('itemDesc').value;
    const itemPicBase64 = document.getElementById('itemImage').getAttribute('data-base64');
    const category = document.getElementById('itemCategory').value;
    const size= document.getElementById('size').value;
    const quantity = document.getElementById('quantity').value;
    const supplierCode = document.getElementById('supplierCode').value;
    const supplierName = document.getElementById('supplierName').value;
    const unitPriceSale = document.getElementById('unitPrice').value;
    const unitPriceBuy = document.getElementById('unitPriceBuy').value;
    const expectProfit = document.getElementById('profit').value;
    const profitMargin = document.getElementById('profitMargin').value;
    const status = document.getElementById('status').value;


    const item = {
      itemCode:itemCode,
      itemDesc:itemDesc,
      itemPicture:itemPicBase64,
      category:category,
      size:size,
      quantity:quantity,
      supplierCode:supplierCode,
      supplierName:supplierName,
      unitPriceSale:unitPriceSale,
      unitPriceBuy:unitPriceBuy,
      expectProfit:expectProfit,
      profitMargin:profitMargin,
      status:status,
    }

    $.ajax({
      url: 'http://localhost:8080/app/api/v1/inventories/update',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(item),
      success: function (response) {
        console.log(response);
        /*document.getElementById('customerForm').reset();*/
        alert('Item information Updated successfully!');
        getAllItems();

      },
      error: function (xhr, status, error) {
        console.error(error);
        alert('Failed to update item information. Please try again.');
      }
    });
  }

  /*table click*/
  $('#inventoryTable').on('click', 'tr', function (){
    var itemCode = $(this).find('td:eq(0)').text();
    var itemDesc = $(this).find('td:eq(1)').text();
    var itemPicture = $(this).find('td:eq(2)').text();
    var category = $(this).find('td:eq(3)').text();
    var size = $(this).find('td:eq(4)').text();
    var quantity = $(this).find('td:eq(5)').text();
    var supplierCode = $(this).find('td:eq(6)').text();
    var supplierName = $(this).find('td:eq(7)').text();
    var unitPriceSale = $(this).find('td:eq(8)').text();
    var unitPriceBuy = $(this).find('td:eq(9)').text();
    var expectProfit = $(this).find('td:eq(10)').text();
    var profitMargin = $(this).find('td:eq(11)').text();
    var status = $(this).find('td:eq(12)').text();

    $("#itemCode").val(itemCode);
    $("#itemDesc").val(itemDesc);
    $("#itemImage").val(itemPicture);
    $("#category").val(category);
    $("#size").val(size);
    $("#quantity").val(quantity);
    $("#supplierCode").val(supplierCode);
    $("#supplierName").val(supplierName);
    $("#unitPrice").val(unitPriceSale);
    $("#unitPriceBuy").val(unitPriceBuy);
    $("#profit").val(expectProfit);
    $("#profitMargin").val(profitMargin);
    $("#status").val(status);

  })

  $(document).ready(function () {
    getAllItems();

    $('#btnItemDelete').on('click', function() {
      var itemCode = $('#itemCode').val();
      if (itemCode !== "") {
        deleteItem(itemCode);
      } else {
        alert("Please select a customer to delete.");
      }
    });
  });

  /*delete customer*/
  function deleteItem(itemCode) {
    $.ajax({
      url: 'http://localhost:8080/app/api/v1/inventories/' + itemCode,
      type: 'DELETE',
      success: function (response) {
        console.log(response);
        alert('Item deleted successfully!');
        getAllCustomers();
      },
      error: function (xhr, status, error) {
        console.error(error);
        alert('Failed to delete Item. Please try again.');
      }
    });
  }

  /*$("#btnItemSearch").on("click", function () {
    var search = $("#searchInput").val(); // Assuming the input field has id="searchInput"
    $("#inventoryTable").empty();

    $.ajax({
      url: 'http://localhost:8080/app/api/v1/inventories/search',
      method: "GET",
      data: {
        id: search
      },
      contentType: "application/json",
      dataType: "json",
      success: function (res) {
        console.log(res);
        if (res) {
          let itemCode = res.itemCode;
          let itemDesc = res.itemDesc;
          let itemImage = res.itemPicture;
          let category = res.category;
          let size = res.size;
          let quantity = res.quantity;
          let supplierCode = res.supplierCode;
          let supplierName = res.supplierName;
          let unitPrice = res.unitPriceSale;
          let unitPriceBuy = res.unitPriceBuy;
          let profit = res.expectProfit;
          let profitMargin = res.profitMargin;
          let status = res.status;

          let row = "<tr><td>" + itemCode + "</td><td>" + itemDesc + "</td><td>" + itemImage + "</td><td>" + category + "</td><td>" + size + "</td><td>" + quantity +
                  "</td><td>" + supplierCode + "</td><td>" + supplierName + "</td><td>" + unitPrice + "</td><td>" + unitPriceBuy + "</td><td>" + profit + "</td>" +
                  "<td>" + profitMargin + "</td><td>" + status + "</td></tr>";

          // Insert the row at the beginning of the table
          $("#inventoryTable").prepend(row);
        } else {
          console.log("No data found");
        }
      },
      error: function (error) {
        console.error(error);
        alert('Failed to search for items. Please try again.');
      }
    });
  });*/


  $("#btnItemSearch").on("click", function () {
    var search = $("#searchInput").val();
    $("#inventoryTable").empty();

    $.ajax({
      url: 'http://localhost:8080/app/api/v1/inventories/search?id' +id,
      method: "GET",
      data: { id: search },
      contentType: "application/json",
      dataType: "json",
      success: function (res) {
        console.log(res);
        if (res && res.length > 0) {
          // Assuming res is an array of objects
          let firstItem = res[0]; // Assuming you only want details of the first item

          let row = "<tr><td>" + firstItem.itemCode + "</td><td>" + firstItem.itemDesc + "</td><td>" + firstItem.itemPicture + "</td><td>" + firstItem.category + "</td><td>" + firstItem.size + "</td><td>" + firstItem.quantity +
                  "</td><td>" + firstItem.supplierCode + "</td><td>" + firstItem.supplierName + "</td><td>" + firstItem.unitPriceSale + "</td><td>" + firstItem.unitPriceBuy + "</td><td>" + firstItem.expectProfit + "</td>" +
                  "<td>" + firstItem.profitMargin + "</td><td>" + firstItem.status + "</td></tr>";

          // Insert the row before any existing rows
          $("#inventoryTable").append(row);

          // If you want to display other items as well, you can loop through the remaining items and append them to the table
          for (let i = 1; i < res.length; i++) {
            let currentItem = res[i];
            let itemRow = "<tr><td>" + currentItem.itemCode + "</td><td>" + currentItem.itemDesc + "</td><td>" + currentItem.itemPicture + "</td><td>" + currentItem.category + "</td><td>" + currentItem.size + "</td><td>" + currentItem.quantity +
                    "</td><td>" + currentItem.supplierCode + "</td><td>" + currentItem.supplierName + "</td><td>" + currentItem.unitPriceSale + "</td><td>" + currentItem.unitPriceBuy + "</td><td>" + currentItem.expectProfit + "</td>" +
                    "<td>" + currentItem.profitMargin + "</td><td>" + currentItem.status + "</td></tr>";

            $("#inventoryTable").append(itemRow);
          }
        } else {
          console.log("No data found");
          alert("No Data Found")
          // Display a message to the user
          $("#inventoryTable").append("<tr><td colspan='13'>No data found</td></tr>");
        }
      },
      error: function (error) {
        console.error(error);
        alert('Failed to search for items. Please try again.');
      }
    });
  });

  $(document).ready(function () {
    getAllItems();
  });

  function customerCapitalizeFirstLetter(str) {
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
  }


</script>
</body>
</html>
